{
  "schema_version": "1.0",
  "id": "email-service-prefab",
  "version": "1.1.0",
  "name": "邮件服务预制件",
  "description": "基于 SMTP 协议的邮件发送服务，支持 HTML 内容、抄送、密送和附件",
  "author": "ketd",
  "github_url": "https://github.com/ketd/Email-service-Prefab",
  "tags": [
    "email",
    "smtp",
    "mail",
    "notification"
  ],
  "entry_point": "src/main.py",
  "dependencies_file": "pyproject.toml",
  "functions": [
    {
      "name": "send_email",
      "description": "发送邮件，支持 HTML 内容、抄送、密送和附件",
      "parameters": [
        {
          "name": "to",
          "type": "string",
          "description": "收件人邮箱地址，多个地址用逗号分隔，例如 'user1@example.com,user2@example.com'",
          "required": true
        },
        {
          "name": "subject",
          "type": "string",
          "description": "邮件主题",
          "required": true
        },
        {
          "name": "body",
          "type": "string",
          "description": "邮件正文内容",
          "required": true
        },
        {
          "name": "cc",
          "type": "string",
          "description": "抄送地址，多个地址用逗号分隔",
          "required": false
        },
        {
          "name": "bcc",
          "type": "string",
          "description": "密送地址，多个地址用逗号分隔",
          "required": false
        },
        {
          "name": "body_type",
          "type": "string",
          "description": "邮件正文类型，'plain' 表示纯文本，'html' 表示 HTML 格式",
          "required": false,
          "default": "plain",
          "enum": ["plain", "html"]
        }
      ],
      "files": {
        "attachments": {
          "type": "array",
          "items": {
            "type": "InputFile"
          },
          "minItems": 0,
          "maxItems": 10,
          "description": "附件文件（可选，最多10个）",
          "required": false
        }
      },
      "returns": {
        "type": "object",
        "description": "包含发送结果的对象",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "操作是否成功"
          },
          "message": {
            "type": "string",
            "description": "成功消息（成功时）",
            "optional": true
          },
          "recipients": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "收件人列表（成功时）",
            "optional": true
          },
          "cc": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "抄送列表（成功时且有抄送）",
            "optional": true
          },
          "bcc_count": {
            "type": "integer",
            "description": "密送人数（成功时且有密送）",
            "optional": true
          },
          "error": {
            "type": "string",
            "description": "错误信息（失败时）",
            "optional": true
          },
          "error_code": {
            "type": "string",
            "description": "错误代码（失败时）",
            "optional": true,
            "enum": [
              "MISSING_SMTP_CONFIG",
              "INVALID_RECIPIENT",
              "INVALID_SUBJECT",
              "INVALID_BODY",
              "INVALID_BODY_TYPE",
              "ATTACHMENT_NOT_FOUND",
              "ATTACHMENT_ERROR",
              "INVALID_PORT",
              "SMTP_AUTH_ERROR",
              "SMTP_ERROR",
              "SMTP_CONNECTION_ERROR",
              "UNEXPECTED_ERROR"
            ]
          },
          "missing_configs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "缺少的配置项列表（当错误代码为 MISSING_SMTP_CONFIG 时）",
            "optional": true
          }
        }
      },
      "secrets": [
        {
          "name": "SMTP_HOST",
          "description": "SMTP 服务器地址",
          "instructions": "例如：smtp.gmail.com（Gmail）、smtp.qq.com（QQ 邮箱）、smtp.163.com（网易邮箱）",
          "required": true
        },
        {
          "name": "SMTP_PORT",
          "description": "SMTP 服务器端口",
          "instructions": "常用端口：587（TLS）、465（SSL）、25（非加密，不推荐）",
          "required": true
        },
        {
          "name": "SMTP_USERNAME",
          "description": "SMTP 用户名（通常是完整的邮箱地址）",
          "instructions": "例如：your-email@example.com",
          "required": true
        },
        {
          "name": "SMTP_PASSWORD",
          "description": "SMTP 密码或授权码",
          "instructions": "注意：某些邮件服务商（如 Gmail、QQ 邮箱）需要使用应用专用密码或授权码，而不是账户登录密码。请查阅您的邮件服务商文档获取授权码。",
          "required": true
        },
        {
          "name": "SMTP_USE_TLS",
          "description": "是否使用 TLS 加密连接",
          "instructions": "值为 'true' 或 'false'。端口 587 通常使用 TLS（设为 true），端口 465 使用 SSL（设为 false）。默认为 true。",
          "required": false
        }
      ]
    },
    {
      "name": "send_bulk_email",
      "description": "批量发送邮件，向多个收件人分别发送相同内容的邮件",
      "parameters": [
        {
          "name": "recipients",
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "收件人邮箱地址列表",
          "required": true
        },
        {
          "name": "subject",
          "type": "string",
          "description": "邮件主题",
          "required": true
        },
        {
          "name": "body",
          "type": "string",
          "description": "邮件正文内容",
          "required": true
        },
        {
          "name": "body_type",
          "type": "string",
          "description": "邮件正文类型，'plain' 表示纯文本，'html' 表示 HTML 格式",
          "required": false,
          "default": "plain",
          "enum": ["plain", "html"]
        }
      ],
      "returns": {
        "type": "object",
        "description": "包含批量发送结果的对象",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "所有邮件是否都发送成功"
          },
          "total": {
            "type": "integer",
            "description": "总邮件数",
            "optional": true
          },
          "succeeded": {
            "type": "integer",
            "description": "成功发送的邮件数",
            "optional": true
          },
          "failed": {
            "type": "integer",
            "description": "发送失败的邮件数",
            "optional": true
          },
          "results": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "description": "每封邮件的发送结果详情",
            "optional": true
          },
          "error": {
            "type": "string",
            "description": "错误信息（参数验证失败时）",
            "optional": true
          },
          "error_code": {
            "type": "string",
            "description": "错误代码（参数验证失败时）",
            "optional": true,
            "enum": [
              "INVALID_RECIPIENTS",
              "INVALID_SUBJECT",
              "INVALID_BODY",
              "UNEXPECTED_ERROR"
            ]
          }
        }
      },
      "secrets": [
        {
          "name": "SMTP_HOST",
          "description": "SMTP 服务器地址",
          "instructions": "例如：smtp.gmail.com（Gmail）、smtp.qq.com（QQ 邮箱）、smtp.163.com（网易邮箱）",
          "required": true
        },
        {
          "name": "SMTP_PORT",
          "description": "SMTP 服务器端口",
          "instructions": "常用端口：587（TLS）、465（SSL）、25（非加密，不推荐）",
          "required": true
        },
        {
          "name": "SMTP_USERNAME",
          "description": "SMTP 用户名（通常是完整的邮箱地址）",
          "instructions": "例如：your-email@example.com",
          "required": true
        },
        {
          "name": "SMTP_PASSWORD",
          "description": "SMTP 密码或授权码",
          "instructions": "注意：某些邮件服务商（如 Gmail、QQ 邮箱）需要使用应用专用密码或授权码，而不是账户登录密码。请查阅您的邮件服务商文档获取授权码。",
          "required": true
        },
        {
          "name": "SMTP_USE_TLS",
          "description": "是否使用 TLS 加密连接",
          "instructions": "值为 'true' 或 'false'。端口 587 通常使用 TLS（设为 true），端口 465 使用 SSL（设为 false）。默认为 true。",
          "required": false
        }
      ]
    },
    {
      "name": "send_email_with_template",
      "description": "使用预定义模板发送美观的 HTML 邮件，支持 notification（通知）、welcome（欢迎）、alert（警告）、report（报告）四种模板",
      "parameters": [
        {
          "name": "to",
          "type": "string",
          "description": "收件人邮箱地址，多个地址用逗号分隔",
          "required": true
        },
        {
          "name": "subject",
          "type": "string",
          "description": "邮件主题",
          "required": true
        },
        {
          "name": "template_type",
          "type": "string",
          "description": "模板类型",
          "required": true,
          "enum": ["notification", "welcome", "alert", "report"]
        },
        {
          "name": "template_data",
          "type": "object",
          "description": "模板数据，根据不同模板类型需要提供不同的字段。notification需要title/heading/message；welcome需要title/message；alert需要title/alert_title/message；report需要title/summary_title/message。可选字段包括button_text/button_url/features/details/stats/extra_content/footer",
          "required": true
        },
        {
          "name": "cc",
          "type": "string",
          "description": "抄送地址，多个地址用逗号分隔",
          "required": false
        },
        {
          "name": "bcc",
          "type": "string",
          "description": "密送地址，多个地址用逗号分隔",
          "required": false
        }
      ],
      "files": {
        "attachments": {
          "type": "array",
          "items": {
            "type": "InputFile"
          },
          "minItems": 0,
          "maxItems": 10,
          "description": "附件文件（可选，最多10个）",
          "required": false
        }
      },
      "returns": {
        "type": "object",
        "description": "包含发送结果的对象",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "操作是否成功"
          },
          "message": {
            "type": "string",
            "description": "成功消息（成功时）",
            "optional": true
          },
          "recipients": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "收件人列表（成功时）",
            "optional": true
          },
          "cc": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "抄送列表（成功时且有抄送）",
            "optional": true
          },
          "bcc_count": {
            "type": "integer",
            "description": "密送人数（成功时且有密送）",
            "optional": true
          },
          "template_type": {
            "type": "string",
            "description": "使用的模板类型（成功时）",
            "optional": true
          },
          "error": {
            "type": "string",
            "description": "错误信息（失败时）",
            "optional": true
          },
          "error_code": {
            "type": "string",
            "description": "错误代码（失败时）",
            "optional": true,
            "enum": [
              "INVALID_RECIPIENT",
              "INVALID_SUBJECT",
              "INVALID_TEMPLATE_TYPE",
              "INVALID_TEMPLATE_DATA",
              "MISSING_TEMPLATE_FIELD",
              "MISSING_SMTP_CONFIG",
              "ATTACHMENT_NOT_FOUND",
              "ATTACHMENT_ERROR",
              "INVALID_PORT",
              "SMTP_AUTH_ERROR",
              "SMTP_ERROR",
              "SMTP_CONNECTION_ERROR",
              "UNEXPECTED_ERROR"
            ]
          }
        }
      },
      "secrets": [
        {
          "name": "SMTP_HOST",
          "description": "SMTP 服务器地址",
          "instructions": "例如：smtp.gmail.com（Gmail）、smtp.qq.com（QQ 邮箱）、smtp.163.com（网易邮箱）",
          "required": true
        },
        {
          "name": "SMTP_PORT",
          "description": "SMTP 服务器端口",
          "instructions": "常用端口：587（TLS）、465（SSL）、25（非加密，不推荐）",
          "required": true
        },
        {
          "name": "SMTP_USERNAME",
          "description": "SMTP 用户名（通常是完整的邮箱地址）",
          "instructions": "例如：your-email@example.com",
          "required": true
        },
        {
          "name": "SMTP_PASSWORD",
          "description": "SMTP 密码或授权码",
          "instructions": "注意：某些邮件服务商（如 Gmail、QQ 邮箱）需要使用应用专用密码或授权码，而不是账户登录密码。请查阅您的邮件服务商文档获取授权码。",
          "required": true
        },
        {
          "name": "SMTP_USE_TLS",
          "description": "是否使用 TLS 加密连接",
          "instructions": "值为 'true' 或 'false'。端口 587 通常使用 TLS（设为 true），端口 465 使用 SSL（设为 false）。默认为 true。",
          "required": false
        }
      ]
    }
  ],
  "execution_environment": {
    "cpu": "500m",
    "memory": "256Mi"
  }
}
